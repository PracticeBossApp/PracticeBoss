<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guitar Practice Timer</title>
    <style>
        :root {
            --primary: #4f46e5;
            --success: #10b981;
            --danger: #ef4444;
            --bg: #f3f4f6;
            --text: #1f2937;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            max-width: 400px;
            margin: auto; 
        }

        .settings {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .settings-row {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .settings label {
            font-size: 0.8rem;
            font-weight: 700;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
        }

        .horizontal-group {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        input[type="number"], select {
            padding: 0.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 1rem;
            outline: none;
            background: white;
        }

        input[type="number"] { width: 70px; }
        select { width: 100%; max-width: 200px; cursor: pointer; }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: 0.6rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            width: 100%;
            display: block;
            box-sizing: border-box;
            font-size: 1rem;
        }

        .btn:active { transform: scale(0.96); }
        
        .btn-secondary {
            background: #6366f1;
            font-size: 0.85rem;
            width: auto;
        }

        .btn-pause { background-color: var(--danger); margin-bottom: 10px; }
        .btn-play { background-color: var(--success); margin-bottom: 10px; }

        .toggle-btn {
            width: 100%;
            max-width: 200px;
        }
        .on { background-color: var(--success) !important; }
        .off { background-color: var(--danger) !important; }

        .timer-circle {
            width: 90px;
            height: 90px;
            margin: 0 auto 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--primary);
            border: 5px solid #e5e7eb;
            border-radius: 50%;
        }

        #exercise-display {
            font-size: 1.4rem;
            font-weight: 800;
            margin: 0.5rem 0 1.5rem;
            color: var(--primary);
            min-height: 5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.3;
            padding: 0 10px;
        }

        .status-bar {
            font-size: 0.7rem;
            color: #9ca3af;
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>

    <div class="card">
        <div class="settings">
            <div class="settings-row">
                <label>Update Interval</label>
                <div class="horizontal-group">
                    <input type="number" id="interval-input" value="60" min="5">
                    <button class="btn btn-secondary" onclick="updateInterval()">Apply Time</button>
                </div>
            </div>
            
            <div class="settings-row">
                <label>Sound Control</label>
                <div class="input-group">
                    <button id="announcer-btn" class="btn toggle-btn on" onclick="toggleAnnouncer()">Announcer: ON</button>
                    <button id="bell-btn" class="btn toggle-btn on" onclick="toggleBell()">Bell: ON</button>
                    <button id="drone-btn" class="btn toggle-btn off" onclick="toggleDrone()">Drone: OFF</button>
                    <select id="drone-select" onchange="updateDroneFrequency()">
                        <option value="196.00">G3</option>
                        <option value="207.65">G#3</option>
                        <option value="220.00">A3</option>
                        <option value="233.08">A#3</option>
                        <option value="246.94">B3</option>
                        <option value="261.63">C4</option>
                        <option value="277.18">C#4</option>
                        <option value="293.66">D4</option>
                        <option value="311.13">D#4</option>
                        <option value="329.63">E4</option>
                        <option value="349.23">F4</option>
                        <option value="369.99">F#4</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="timer-circle" id="timer-display">60</div>
        
        <p style="color: #6b7280; margin: 0; font-size: 0.9rem;">Current Exercise:</p>
        <div id="exercise-display">Ready</div>
        
        <button id="play-pause-btn" class="btn btn-pause" onclick="togglePlayPause()">Pause</button>
        <button class="btn" onclick="triggerNext()">Next Exercise</button>
        
        <div class="status-bar">
            <span id="bell-status-icon">üîî Bell Active</span>
            <span id="voice-status-icon">üó£Ô∏è Announcer Active</span>
            <span id="drone-status-icon">üéµ Drone Muted</span>
        </div>
    </div>

    <script>
        const bellAudio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');
        const synth = window.speechSynthesis;
        let femaleVoice = null;
        
        let audioCtx = null;
        let oscillator = null;
        let gainNode = null;

        let isAnnouncerOn = true;
        let isBellOn = true;
        let isDroneOn = false;
        let isPaused = false;
        let timerInterval = null;
        
        // Tracking variable to prevent repeats
        let lastExerciseIndex = -1;

        const exerciseList = [
            "Play triads only", 
            "Play major scale", 
            "Major Pentatonic", 
            "Major chord arpeggios", 
            "Use only 3 Notes Per String",
            "Switch non-adjacent CAGED shapes",
            "Sing the notes while playing",
            "Improvise above the 7th fret",
            "Improvise between the 3rd and 9th fret", 
            "Improvise below the 7th fret", 
            "Major scale without playing adjacent notes",
            "Connect 2 CAGED shapes",
            "Play only lines that descend",
            "Improvise using only one string",
            "Every time the B string is played, switch positions",
            "Don't play any notes on the D string",
            "Improvise using only the top 3 strings",
            "Improvise using only the bottom 3 strings"
        ];

        let maxInterval = 60;
        let timeLeft = 60;
        
        const timerEl = document.getElementById('timer-display');
        const exerciseEl = document.getElementById('exercise-display');
        const inputEl = document.getElementById('interval-input');
        const announcerBtn = document.getElementById('announcer-btn');
        const bellBtn = document.getElementById('bell-btn');
        const droneBtn = document.getElementById('drone-btn');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const voiceStatusIcon = document.getElementById('voice-status-icon');
        const bellStatusIcon = document.getElementById('bell-status-icon');
        const droneStatusIcon = document.getElementById('drone-status-icon');
        const droneSelect = document.getElementById('drone-select');

        function initAudioContext() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                gainNode = audioCtx.createGain();
                gainNode.connect(audioCtx.destination);
                gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function toggleDrone() {
            initAudioContext();
            isDroneOn = !isDroneOn;
            if (isDroneOn) {
                droneBtn.innerText = "Drone: ON";
                droneBtn.className = "btn toggle-btn on";
                droneStatusIcon.innerText = "üéµ Drone Active";
                if (!oscillator) {
                    oscillator = audioCtx.createOscillator();
                    oscillator.type = 'sine';
                    oscillator.connect(gainNode);
                    oscillator.start();
                }
                updateDroneFrequency();
                gainNode.gain.setTargetAtTime(0.1, audioCtx.currentTime, 0.05);
            } else {
                droneBtn.innerText = "Drone: OFF";
                droneBtn.className = "btn toggle-btn off";
                droneStatusIcon.innerText = "üéµ Drone Muted";
                gainNode.gain.setTargetAtTime(0, audioCtx.currentTime, 0.05);
            }
        }

        function updateDroneFrequency() {
            if (oscillator && audioCtx) {
                const freq = parseFloat(droneSelect.value);
                oscillator.frequency.setTargetAtTime(freq, audioCtx.currentTime, 0.05);
            }
        }

        function togglePlayPause() {
            initAudioContext();
            isPaused = !isPaused;
            if (isPaused) {
                playPauseBtn.innerText = "Play";
                playPauseBtn.className = "btn btn-play";
                clearInterval(timerInterval);
            } else {
                playPauseBtn.innerText = "Pause";
                playPauseBtn.className = "btn btn-pause";
                startTimer();
            }
        }

        function toggleAnnouncer() {
            isAnnouncerOn = !isAnnouncerOn;
            if (isAnnouncerOn) {
                announcerBtn.innerText = "Announcer: ON";
                announcerBtn.className = "btn toggle-btn on";
                voiceStatusIcon.innerText = "üó£Ô∏è Announcer Active";
            } else {
                announcerBtn.innerText = "Announcer: OFF";
                announcerBtn.className = "btn toggle-btn off";
                voiceStatusIcon.innerText = "üîá Announcer Muted";
                synth.cancel();
            }
        }

        function toggleBell() {
            isBellOn = !isBellOn;
            if (isBellOn) {
                bellBtn.innerText = "Bell: ON";
                bellBtn.className = "btn toggle-btn on";
                bellStatusIcon.innerText = "üîî Bell Active";
            } else {
                bellBtn.innerText = "Bell: OFF";
                bellBtn.className = "btn toggle-btn off";
                bellStatusIcon.innerText = "üîï Bell Muted";
            }
        }

        function loadVoices() {
            const voices = synth.getVoices();
            femaleVoice = voices.find(v => 
                v.name.includes('Female') || v.name.includes('Google US English') || 
                v.name.includes('Samantha') || v.name.includes('Zira')
            ) || voices[0];
        }

        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }

        function speakWord(text) {
            if (!isAnnouncerOn) return;
            if (synth.speaking) synth.cancel();
            const utterThis = new SpeechSynthesisUtterance(text);
            utterThis.voice = femaleVoice;
            utterThis.pitch = 1.1;
            utterThis.rate = 0.9;
            synth.speak(utterThis);
        }

        function playBell() {
            if (!isBellOn) return;
            bellAudio.currentTime = 0;
            bellAudio.play().catch(() => {});
        }

        function getRandomExercise() {
            let randomIndex;
            
            // Loop until we get a index that isn't the same as the last one
            do {
                randomIndex = Math.floor(Math.random() * exerciseList.length);
            } while (randomIndex === lastExerciseIndex);
            
            lastExerciseIndex = randomIndex;
            const nextExercise = exerciseList[randomIndex];
            
            exerciseEl.innerText = nextExercise;
            playBell();
            
            setTimeout(() => { 
                if (!isPaused) speakWord(nextExercise); 
            }, 2000);
        }

        function updateTimer() {
            timeLeft--;
            if (timeLeft < 0) {
                timeLeft = maxInterval;
                getRandomExercise();
            }
            timerEl.innerText = timeLeft;
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateInterval() {
            const newVal = parseInt(inputEl.value);
            if (isNaN(newVal) || newVal < 5) {
                alert("Min 5 seconds.");
                return;
            }
            maxInterval = newVal;
            timeLeft = maxInterval;
            timerEl.innerText = timeLeft;
            getRandomExercise();
        }

        function triggerNext() {
            initAudioContext();
            timeLeft = maxInterval;
            timerEl.innerText = timeLeft;
            getRandomExercise();
        }

        loadVoices();
        startTimer();
    </script>
</body>
</html>